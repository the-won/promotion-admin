<template>
  <table cellspacing="0" cellpadding="0" width="730" align="center" border="0">
    <tbody>
      <tr>
        <td>

          <!-- header table -->
          <table cellspacing="0" cellpadding="0" width="100%" border="0">
              <!-- 2013-06-19 username ê°„ê²© ìˆ˜ì • -->
              <tbody>
                <tr>
                  <td height="88" rowspan="2" width="148"><img alt="BENEPIA" src="https://newfront.benepia.co.kr/upload/xquared/b9d3364e-f386-4138-a6a4-6d61ed93422c.gif" width="148" height="88"><!-- 2022-02-15 BIë³€ê²½ --></td>
                  <td height="51" align="right"></td>
                  <td height="88" rowspan="2" width="325">
                    <a href="https://newfront.benepia.co.kr/gatepage/emGateway.do?pcUrl=https://$:domain:$.benepia.co.kr/frnt/mypage/main.do?mnuTopLevel=0%26mnuLevel=0&mbUrl=https://mr2.benepia.co.kr/gateLink.bene?domain=$:domain:$%26linkUrl=/frnt/mypage/pointInfo.bene"  target="_blank" title="ìƒì„¸ì¡°íšŒ">
                      <!-- 2020-05-26 ì´ë¯¸ì§€ ê²½ë¡œ ìˆ˜ì • -->
                      <img border="0" alt="ì˜ ë² ë„¤í”¼ì•„ ì”ì—¬ í¬ì¸íŠ¸ë¥¼ ì§€ê¸ˆ í™•ì¸í•˜ì„¸ìš”!" src="https://i.benepia.co.kr/ckeditor/D9E5A1E20280.mns0115844189801720.gif" width="325" height="88">
                    </a>
                  </td>
                </tr>
                <tr> 
            <td :style="`font-size: 12px`" height="37" valign="top" align="right"><strong>%UserName%ë‹˜</strong></td>
                </tr>
                <!-- // 2013-06-19 username ê°„ê²© ìˆ˜ì • -->
              </tbody>
          </table>

          <!-- contents table -->
          <table :style="`border:1px solid #bebebe;`" cellspacing="0" cellpadding="0" width="720">
            <tbody>
               <tr v-for="group in data.imageLinkGroups" :key="group.id">
                  <td align="center" :style="{ paddingBottom: '3px', paddingTop: '3px', paddingLeft: '3px', paddingRight: '3px' }">
                    <a 
                      :href="group.href" 
                      :target="group.targetBlank ? '_blank' : '_self'" 
                      rel="noopener noreferrer"
                    >
                      <!-- ê·¸ë£¹ ë‚´ì˜ ëª¨ë“  ì´ë¯¸ì§€ ë Œë”ë§ -->
                      <img 
                        v-for="image in group.images" 
                        :key="image.id"
                        :ref="`image-${group.id}-${image.id}`"
                        :src="image.url" 
                        :alt="image.alt"
                        :class="{ 'highlight-image': isImageActive(group.id, image.id) }"
                      />
                    </a>
                  </td>
                </tr>
            </tbody>
          </table>

          <!-- footer table -->
          <table cellSpacing=0 cellPadding=0 width=728 border=0>
            <tbody>
              <tr> 
              <td :style="`HEIGHT: 5px`"></td>
              </tr>
              <tr>
              <td :style="{ background: '#f2f2f2', padding: '18px 9px' }"><table style="TEXT-ALIGN: left" cellSpacing="0" cellPadding="0" width="100%" border="0">
                <tbody>
                  <tr>
                  <td :style="`font-size: 12px; font-family: 'ë‹ì›€',dotum,sans-serif; color: #5b5b5b`"> Â· ë³¸ ë©”ì¼ì€ 2025ë…„ 12ì›” 11ì¼ ê¸°ì¤€ íšŒì›ë‹˜ì˜ ë² ë„¤í”¼ì•„ ì´ë©”ì¼ ìˆ˜ì‹  ë™ì˜ ì—¬ë¶€ë¥¼ í™•ì¸í•œ ê²°ê³¼, ìˆ˜ì‹ ì— ë™ì˜í•˜ì˜€ê¸°ì— ë°œì†¡ë©ë‹ˆë‹¤.</td>
                  </tr> 
                  <tr>
                  <td :style="`font-size: 12px; font-family: 'ë‹ì›€',dotum,sans-serif; color: #5b5b5b; padding-top: 4px`"> Â· ë² ë„¤í”¼ì•„ ë©”ì¼ì„ ìˆ˜ì‹ ì„ ì›í•˜ì§€ ì•Šìœ¼ì‹œë©´, <a style="color: #21a7e5; TEXT-DECORATION: none" href="https://$:domain:$.benepia.co.kr/mail/rcvMailYn/rcvMailYn.do?encMailId=$:enc_mail_id:$&encMbrId=$:enc_mbr_id:$" target="_blank" title="ìƒˆì°½ì—´ë¦¼"><strong>[ìˆ˜ì‹ ê±°ë¶€]</strong></a>ë¥¼ í´ë¦­í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤. (If you don`t want this of information or <br />
                    &nbsp;&nbsp;e-mail, please <a :style="`color: #21a7e5; TEXT-DECORATION: none`" href="https://$:domain:$.benepia.co.kr/mail/rcvMailYn/rcvMailYn.do?encMailId=$:enc_mail_id:$&encMbrId=$:enc_mbr_id:$" target="_blank" title="ìƒˆì°½ì—´ë¦¼"> <strong>[click the Refusal]</strong></a>) </td>				  
                  </tr>
                  <tr>
                  <td :style="`font-size: 12px; font-family: 'ë‹ì›€',dotum,sans-serif; color: #5b5b5b; padding-top: 4px`"> Â· ë³¸ ë©”ì¼ì€ ë°œì‹ ì „ìš©ìœ¼ë¡œ íšŒì‹ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê¶ê¸ˆí•˜ì‹  ì‚¬í•­ì€ <a style="COLOR: #21a7e5; TEXT-DECORATION: none" href="https://$:domain:$.benepia.co.kr/frnt/mypage/qnaList.do?mnuId=84&amp;mnuTopLevel=11&amp;mnuLevel=1&amp;list" target="_blank" title="ìƒˆì°½ì—´ë¦¼"><strong>[ì˜¨ë¼ì¸ë¬¸ì˜]</strong></a>ë¡œ ë¬¸ì˜í•˜ì‹œë©´ ì¹œì ˆí•˜ê²Œ ì•ˆë‚´í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤. </td>
                  </tr>
                </tbody>
                </table></td>
              </tr>
              <!-- 2015-02-16, add // -->
              <tr>
              <td><img border="0" alt="Copyright (C) SK M&amp;service. All rights Reserved" src="https://org-i.benepia.co.kr/ckeditor/2025/05/21/afb-19d54843e91e17478007034700.jpg" width="708" height="54"></td>
              </tr>
            </tbody>
          </table>
        </td>
      </tr>
    </tbody>
  </table>

</template>

<script>
export default {
  props: {
    data: {
      type: Object,
      default: () => ({})
    },
    selectedImageInfo: {
      type: Object,
      default: () => ({ groupId: null, imageId: null })
    }
  },
  data() {
    return {
      highlightTimer: null
    }
  },
  methods: {
    isImageActive(groupId, imageId) {
      return this.selectedImageInfo && 
             this.selectedImageInfo.groupId === groupId && 
             this.selectedImageInfo.imageId === imageId
    },
    
    scrollToImage(groupId, imageId) {
      this.$nextTick(() => {
        const refKey = `image-${groupId}-${imageId}`
        const imageEl = this.$refs[refKey]
        
        console.log('ğŸ” ìŠ¤í¬ë¡¤ ì‹œë„:', { refKey, imageEl })
        
        if (imageEl && imageEl[0]) {
          const element = imageEl[0]
          
          // í˜ì´ì§€(window) ìŠ¤í¬ë¡¤ ì‚¬ìš©
          const elementRect = element.getBoundingClientRect()
          
          // í˜„ì¬ ìŠ¤í¬ë¡¤ ìœ„ì¹˜
          const currentScroll = window.pageYOffset || document.documentElement.scrollTop
          
          // ì´ë¯¸ì§€ì˜ ì‹¤ì œ ìœ„ì¹˜ (í˜ì´ì§€ ê¸°ì¤€)
          const elementOffsetTop = elementRect.top + currentScroll
          
          // ì¤‘ì•™ ê³„ì‚°ê°’
          const centerOffset = (window.innerHeight / 2) - (elementRect.height / 2)
          let targetScroll = elementOffsetTop - centerOffset
          
          // ìµœëŒ€/ìµœì†Œ ìŠ¤í¬ë¡¤ ê³„ì‚°
          const maxScroll = document.documentElement.scrollHeight - window.innerHeight
          
          console.log('ğŸ“ ìŠ¤í¬ë¡¤ ê³„ì‚° ì¤‘:', {
            ì´ë¯¸ì§€ìœ„ì¹˜: elementOffsetTop,
            ì¤‘ì•™ì˜¤í”„ì…‹: centerOffset,
            ê³„ì‚°ëœëª©í‘œ: targetScroll,
            ìµœëŒ€ìŠ¤í¬ë¡¤: maxScroll,
            í˜ì´ì§€ë†’ì´: document.documentElement.scrollHeight,
            ìœˆë„ìš°ë†’ì´: window.innerHeight
          })
          
          // ìŒìˆ˜ ìŠ¤í¬ë¡¤ ë°©ì§€ (ìµœì†Œ 0ìœ¼ë¡œ ë³´ì •)
          targetScroll = Math.max(0, targetScroll)
          
          // ìµœëŒ€ ìŠ¤í¬ë¡¤ ì œí•œ
          targetScroll = Math.min(targetScroll, Math.max(0, maxScroll))
          
          console.log('ğŸ“ ìµœì¢… ìŠ¤í¬ë¡¤ ì •ë³´:', {
            í˜„ì¬ìŠ¤í¬ë¡¤: currentScroll,
            ëª©í‘œìŠ¤í¬ë¡¤: targetScroll,
            ìŠ¤í¬ë¡¤ì´ë™ëŸ‰: targetScroll - currentScroll,
            ì´ë¯¸ì§€ë†’ì´: elementRect.height
          })
          
          // í˜ì´ì§€ ìŠ¤í¬ë¡¤ ì‹¤í–‰
          window.scrollTo({ 
            top: targetScroll, 
            behavior: 'smooth' 
          })
          
          console.log('âœ… ìŠ¤í¬ë¡¤ ì™„ë£Œ:', { groupId, imageId })
        } else {
          console.warn('âš ï¸ ì´ë¯¸ì§€ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', refKey)
        }
      })
    }
  },
  
  watch: {
    'selectedImageInfo.timestamp'(newVal) {
      console.log('ğŸ‘€ íƒ€ì„ìŠ¤íƒ¬í”„ ë³€ê²½ë¨:', newVal)
      
      // ê¸°ì¡´ íƒ€ì´ë¨¸ ì œê±°
      if (this.highlightTimer) {
        clearTimeout(this.highlightTimer)
      }
      
      if (this.selectedImageInfo && this.selectedImageInfo.groupId && this.selectedImageInfo.imageId) {
        this.$nextTick(() => {
          this.scrollToImage(this.selectedImageInfo.groupId, this.selectedImageInfo.imageId)
        })
        
        // 2ì´ˆ í›„ í•˜ì´ë¼ì´íŠ¸ ì œê±°
        this.highlightTimer = setTimeout(() => {
          console.log('â° 2ì´ˆ ê²½ê³¼ - í•˜ì´ë¼ì´íŠ¸ ì œê±°')
          this.$emit('clear-highlight')
        }, 2000)
      }
    }
  },
  
  beforeDestroy() {
    // ì»´í¬ë„ŒíŠ¸ ì œê±° ì‹œ íƒ€ì´ë¨¸ ì •ë¦¬
    if (this.highlightTimer) {
      clearTimeout(this.highlightTimer)
    }
  }
}
</script>

<style scoped>
.highlight-image {
  outline: 3px solid #6366f1;
  outline-offset: 2px;
  box-shadow: 0 0 12px rgba(99, 102, 241, 0.5);
  animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% {
    outline-color: #6366f1;
    box-shadow: 0 0 12px rgba(99, 102, 241, 0.5);
  }
  50% {
    outline-color: #818cf8;
    box-shadow: 0 0 20px rgba(99, 102, 241, 0.8);
  }
}
</style>