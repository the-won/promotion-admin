<template>
  <table id="__01" cellspacing="0" cellpadding="0" width="770" align="center" border="0">
    <tbody>
      <!-- ë¡œê³  -->
      <tr>
        <td style="font-size:0; vertical-align:top;">
          <a href="https://benepia.efamilyshop.co.kr/" target="_blank">
            <img src="https://www.efamilyshop.co.kr/storage/fud/20240528/top_logo_20240528_20240528142617.png" width="770" border="0" alt="e familyshop">
          </a>
        </td>
      </tr>

      <!-- ìƒë‹¨ ì´ë¯¸ì§€ -->
      <tr>
        <td style="font-size:0; vertical-align:top;">
          <a target="_blank" :href="buildHeaderUrl()">
            <img :src="data.headerImage" :alt="data.headerImageAlt" width="770" border="0" />
          </a>
        </td>
      </tr>

      <!-- ğŸ‘‡ ê° ìƒí’ˆ ê·¸ë£¹ -->
      <template v-for="(group, groupIndex) in productGroups">
        <!-- ê·¸ë£¹ íƒ€ì´í‹€ ì´ë¯¸ì§€ -->
        <tr :key="`title-${group.id}`">
          <td style="font-size:0; vertical-align:top;">
            <img :src="group.titleImage.url" :alt="group.titleImage.alt" width="770" border="0" />
          </td>
        </tr>

        <!-- ìƒí’ˆë“¤ (3ê°œì”© ë¬¶ì¸ í–‰ë“¤) -->
        <tr :key="`products-${group.id}`">
          <td style="font-size:0; vertical-align:top;background:#e4e4e4;">
            <table cellspacing="0" cellpadding="0" width="770" border="0">
              <tbody>
                <template v-for="(row, rowIndex) in group.rows">
                  <!-- ìƒí’ˆ 3ê°œ í–‰ -->
                  <tr :key="`row-${row.id}`">
                    <td style="width: 25px;"></td>
                    <td style="font-size:0;vertical-align:top;">
                      <a :href="buildProductUrl(row.products[0].productCode)" style="padding:0;">
                        <img :src="row.products[0].imageUrl" width="234" border="0" :alt="row.products[0].imageAlt" />
                      </a>
                    </td>
                    <td style="width: 9px;"></td>
                    <td style="font-size:0;vertical-align:top;">
                      <a :href="buildProductUrl(row.products[1].productCode)" style="padding:0;">
                        <img :src="row.products[1].imageUrl" width="234" border="0" :alt="row.products[1].imageAlt" />
                      </a>
                    </td>
                    <td style="width: 9px;"></td>
                    <td style="font-size:0;vertical-align:top;">
                      <a :href="buildProductUrl(row.products[2].productCode)" style="padding:0;">
                        <img :src="row.products[2].imageUrl" width="234" border="0" :alt="row.products[2].imageAlt" />
                      </a>
                    </td>
                    <td style="width: 25px;"></td>
                  </tr>

                  <!-- ğŸ‘‡ í–‰ ì‚¬ì´ 11px ê°„ê²© (ë§ˆì§€ë§‰ í–‰ ì œì™¸) -->
                  <tr v-if="rowIndex < group.rows.length - 1" :key="`spacer-${row.id}`">
                    <td colspan="7" height="11">&nbsp;</td>
                  </tr>
                </template>
              </tbody>
            </table>
          </td>
        </tr>

        <!-- ğŸ‘‡ ë§ˆì§€ë§‰ ê·¸ë£¹ ë’¤ì—ë§Œ 60px ê°„ê²© -->
        <tr v-if="groupIndex === productGroups.length - 1" :key="`group-spacer-${group.id}`">
          <td height="60" style="background:#e4e4e4;"></td>
        </tr>
      </template>

      <!-- ğŸ‘‡ ë°°ë„ˆë“¤ -->
      <template v-for="(banner, bannerIndex) in banners">
        <tr :key="`banner-${banner.id}`">
          <td style="font-size:0; vertical-align:top;">
            <a :href="buildBannerUrl(banner.eventCode)" target="_blank" style="padding:0;">
              <img :src="banner.imageUrl" width="770" border="0" :alt="banner.imageAlt" />
            </a>
          </td>
        </tr>

        <!-- ğŸ‘‡ ë°°ë„ˆ ì‚¬ì´: 8px, ë§ˆì§€ë§‰ ë°°ë„ˆ ë’¤: 6px -->
        <tr v-if="bannerIndex < banners.length - 1" :key="`banner-spacer-${banner.id}`">
          <td height="8" style="background:#d8d8d8;"></td>
        </tr>
        <tr v-else-if="bannerIndex === banners.length - 1" :key="`banner-last-spacer-${banner.id}`">
          <td height="6" style="background:#d8d8d8;"></td>
        </tr>
      </template>

      <!-- í‘¸í„° -->
      <tr>
        <td style="font-size:0; vertical-align:top;">
          <table width="770" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td colspan="3" height="35"></td>
            </tr>
            <tr>
              <td style="width: 65px;"></td>
              <td>
                <table width="100%" border="0" cellspacing="0" cellpadding="0" style="width: 650px; font-size:11px; margin:0;padding:0; font-family:'ë§‘ì€ê³ ë”•' 'NanumGothic', 'MalgunGothic', sans-serif; color:#222222;">
                  <tbody>
                    <tr>
                      <td style="vertical-align:text-top; padding-top:5px;">&middot;</td>
                      <td style="padding:3px; line-height:18px;">
                        ë³¸ ë©”ì¼ì€ <a :href="`https://${globalDomain}.efamilyshop.co.kr/shop/front/member/mypage03`" target="_blank"><span style="font-weight:bold; color:#ff4d16;">{{ getFormattedDate() }}</span></a> ê¸°ì¤€ íšŒì›ë‹˜ì˜ ì´íŒ¨ë°€ë¦¬ìƒµ ì´ë©”ì¼ ìˆ˜ì‹  ë™ì˜ ì—¬ë¶€ë¥¼ í™•ì¸í•œ ê²°ê³¼, ìˆ˜ì‹ ì— ë™ì˜í•˜ì˜€ê¸°ì— ë°œì†¡ë©ë‹ˆë‹¤.
                      </td>
                    </tr>
                    <tr>
                      <td style="vertical-align:text-top; padding-top:5px;">&middot;</td>
                      <td style="padding:3px;">ì´íŒ¨ë°€ë¦¬ìƒµ ë©”ì¼ ìˆ˜ì‹ ì„ ì›í•˜ì§€ ì•Šìœ¼ì‹œë©´, <a :href="`https://${globalDomain}.efamilyshop.co.kr/shop/front/unsubscribe.view?c=[$etc2]`" target="_blank"><span style="font-weight:bold; color:#ff4d16;">[ìˆ˜ì‹ ê±°ë¶€]</span></a>í•´ ì£¼ì„¸ìš”ë¥¼ í´ë¦­í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.<br>(If you no longer wish to receive these e-mail, click here to <a :href="`https://${globalDomain}.efamilyshop.co.kr/shop/front/unsubscribe.view?c=[$etc2]`" target="_blank"><span style="font-weight:bold; color:#ff4d16;">[Unsubscribe]</span></a>)</td>
                    </tr>
                    <tr>
                      <td style="vertical-align:text-top; padding-top:5px;">&middot;</td>
                      <td style="padding:3px;">ë³¸ ë©”ì¼ì€ ë°œì‹ ì „ìš© ë©”ì¼ë¡œ íšŒì‹ ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë¬¸ì˜ì‚¬í•­ì€ 1800-1091 ê³ ê°ì„¼í„°ë¡œ ë¬¸ì˜í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</td>
                    </tr>
                    <tr>
                      <td style="vertical-align:text-top; padding-top:5px;">&middot;</td>
                      <td style="padding:3px;">ë³¸ ë©”ì¼ ë‚´ ìƒí’ˆì˜ ê°€ê²© ë° ì •ë³´ëŠ” ë°œì†¡ì¼ ê¸°ì¤€ì´ë¯€ë¡œ ê³ ê°ë‹˜ì˜ ì˜¤í”ˆ ì‹œì ì— ë”°ë¼ ë³€ê²½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </td>
                    </tr>
                  </tbody>
                </table>
              </td>
              <td style="width: 55px;"></td>
            </tr>
            <tr>
              <td colspan="3" height="35"></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td style="font-size:0; vertical-align:top;">
          <table width="770" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td height="100" style="background-color:#f1f1f1;">
                <table width="100%" border="0" cellspacing="0" cellpadding="0">
                  <tbody>
                    <tr>
                      <td width="215" style="padding-left:30px; padding-right:20px;">
                        <a :href="`https://${globalDomain}.efamilyshop.co.kr/`" target="_blank"><img src="https://www.efamilyshop.co.kr/storage/fud/20240528/footer_logo_20240528_20240528142617.png" border="0" alt="í•˜ë‹¨ë¡œê³ " /></a>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </td>
              <td width="555" style="background-color:#f1f1f1;">
                <img src="https://www.efamilyshop.co.kr/storage/fud/20250116/img_em_addr_20250116150819.jpg" border="0" alt="íšŒì‚¬ì •ë³´">
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </tbody>
  </table>
</template>

<script>
export default {
  props: {
    data: {
      type: Object,
      default: () => ({})
    }
  },
  computed: {
    globalDomain() {
      return this.data.globalDomain || 'sema'
    },
    productGroups() {
      return this.data.productGroups || []
    },
    banners() {
      return this.data.banners || []
    }
  },
  methods: {
    buildHeaderUrl() {
      const code = this.data.headerImageCode
      if (!code) return '#'
      const domain = this.globalDomain
      return `https://${domain}.efamilyshop.co.kr/shop/event/eventDetail.view?pageNo=1&eventId=${code}`
    },
    
    buildProductUrl(productCode) {
      if (!productCode) return '#'
      const domain = this.globalDomain
      return `https://${domain}.efamilyshop.co.kr/shop/goods/goodsView.view?goodscode=${productCode}`
    },

    buildBannerUrl(eventCode) {
      if (!eventCode) return '#'
      const domain = this.globalDomain
      return `https://${domain}.efamilyshop.co.kr/shop/event/eventDetail.view?pageNo=1&eventId=${eventCode}`
    },
    getFormattedDate() {
      if (!this.data.sendDate) return ''
      const { year, month, day } = this.data.sendDate
      return `${year}ë…„ ${parseInt(month)}ì›” ${parseInt(day)}ì¼`
    }
  },
  mounted() {
    console.log('EmType4 mounted')
    console.log('Global Domain:', this.globalDomain)
    console.log('Product Groups:', this.productGroups)
    console.log('Banners:', this.banners)
  }
}
</script>